<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bad Alibi — Daily Word Search (Click or Drag to Select)</title>
  <style>
    :root{
      --bg:#f5f5f5; --text:#222; --muted:#666; --card:#fff; --accent:#111; --brand:#111;
      --border:#e7e7e7;
      --radius:16px; --shadow:0 6px 18px rgba(0,0,0,.08); --gap:1rem;
      --grid-size: 12;
      --hint: #ffbf47;
    }
    :root[data-theme="dark"]{
      --bg:#0e0f12; --text:#e8e8e8; --muted:#a0a0a0; --card:#17181c; --accent:#fafafa; --brand:#0ea5e9;
      --border:#2a2c31;
      --shadow:0 6px 18px rgba(0,0,0,.55);
      --hint:#ffd166;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Segoe UI',system-ui,-apple-system,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit}
    .container{width:92%;max-width:1100px;margin:0 auto;padding:2rem 0}
    header{display:flex;flex-wrap:wrap;gap:1rem;align-items:center;justify-content:space-between;margin-bottom:1.25rem}
    .title{display:flex;align-items:center;gap:.75rem}
    .title h1{font-size:clamp(1.25rem,2.5vw,1.75rem);margin:.25rem 0}
    .badge{background:var(--brand);color:#fff;border-radius:999px;padding:.25rem .6rem;font-size:.8rem}
    .cards{display:grid;grid-template-columns:1.25fr .75fr;gap:1.25rem}
    @media (max-width: 900px){.cards{grid-template-columns:1fr}}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--border)}
    .card h2{font-size:1rem;margin:0 0 .5rem;color:var(--accent)}
    .card .head{padding:1rem 1rem .5rem;border-bottom:1px solid var(--border)}
    .card .body{padding:1rem}
    .grid{display:grid;grid-template-columns:repeat(var(--grid-size), 1fr);gap:3px;user-select:none;touch-action:none}
    .cell{
      aspect-ratio:1;border:1px solid var(--border);border-radius:8px;display:flex;align-items:center;justify-content:center;
      font-weight:600;cursor:pointer;transition:transform .05s ease, background .2s ease, border-color .2s ease, color .2s ease
    }
    .cell:hover{transform:translateY(-1px)}
    .cell[data-selected="true"]{background:#e6f0ff;border-color:#cfe0ff}
    :root[data-theme="dark"] .cell[data-selected="true"]{background:#0b3b6d;border-color:#155e9a}
    .cell[data-found="true"]{background:#c6f7d0;border-color:#a9e6b8;color:#0a4;}
    :root[data-theme="dark"] .cell[data-found="true"]{background:#114a2c;border-color:#1f7a4a;color:#7ff1a3}
    @keyframes hintPulse { 0%,100%{box-shadow:0 0 0 0 rgba(255,193,7,0)} 50%{box-shadow:0 0 0 6px rgba(255,193,7,.35)} }
    .cell.hint{ outline:2px solid var(--hint); animation:hintPulse 900ms ease-in-out 2; background: color-mix(in srgb, var(--hint) 25%, transparent); }
    .word.hint{ border-color: var(--hint) !important; background: color-mix(in srgb, var(--hint) 18%, transparent); animation:hintPulse 900ms ease-in-out 2; }
    .bank{display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:.5rem}
    @media (max-width: 600px){.bank{grid-template-columns:1fr}}
    .word{ padding:.4rem .6rem;border:1px dashed var(--border);border-radius:10px;font-weight:600;background:color-mix(in srgb, var(--card) 92%, var(--bg) 8%); display:flex;align-items:center;justify-content:space-between;gap:.5rem;color:var(--text) }
    .word[data-found="true"]{opacity:.55;text-decoration:line-through}
    .meta{display:flex;flex-wrap:wrap;gap:.75rem;color:var(--muted);font-size:.95rem}
    .meta b{color:var(--accent)}
    .controls{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
    button{appearance:none;border:0;background:#111;color:#fff;padding:.6rem .9rem;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);font-weight:600}
    button.subtle{background:#efefef;color:#111}
    button.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    :root[data-theme="dark"] button.subtle{background:#2a2c31;color:#e8e8e8}
    .footer-note{color:var(--muted);font-size:.95rem;margin-top:.75rem}
    .promo{font-size:.95rem;color:var(--text);background:color-mix(in srgb, var(--card) 92%, var(--bg) 8%);border:1px solid var(--border);border-radius:12px;padding:1rem}
    .promo a{font-weight:700;text-decoration:underline}
    .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;padding:.6rem .9rem;border-radius:999px;opacity:0;pointer-events:none;transition:opacity .25s ease}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <span class="badge">Bad Alibi</span>
        <h1>Daily Word Search</h1>
      </div>
      <div class="meta" id="meta"></div>
    </header>

    <div class="cards">
      <section class="card">
        <div class="head">
          <div class="controls">
            <button id="btn-check" class="subtle" title="Check the current selection">Check</button>
            <button id="btn-clear" class="ghost" title="Clear current selection">Clear</button>
            <button id="btn-hint"  class="ghost" title="Show a hint (first & last letter)">Show Hint</button>
            <button id="btn-reveal" class="ghost" title="Reveal one word">Reveal One</button>
            <button id="btn-reset" class="ghost" title="Reset today and start over">Reset Today</button>
            <button id="btn-print" class="subtle" title="Print puzzle">Print</button>
            <button id="btn-theme" class="ghost" title="Toggle dark mode">Dark Mode</button>
            <button id="btn-share" class="ghost" title="Share this puzzle">Share</button>
          </div>
        </div>
        <div class="body">
          <div id="grid" class="grid" aria-label="Word search grid" role="grid"></div>
          <p class="footer-note">Tip: Click or drag in a straight line (horiz, vert, or diagonal). Use <b>Clear</b> to start a new selection.</p>
        </div>
      </section>

      <aside class="card">
        <div class="head">
          <h2>Word Bank</h2>
        </div>
        <div class="body">
          <div id="bank" class="bank" aria-live="polite"></div>
          <div class="promo" style="margin-top:1rem">
            Love this puzzle? Explore more books from our Bad Alibi authors.
            <br />
            • Pamela Pardee — Activity & finance · <a href="https://www.amazon.com/author/pamelapardee" target="_blank" rel="noopener">Amazon</a><br />
            • Harper Lane — Sci-Fi & Romance · <a href="https://www.amazon.com/author/harperlane" target="_blank" rel="noopener">Amazon</a><br />
            • Pamela DuShane — Children’s & Coloring · <a href="https://www.amazon.com/author/pameladushane" target="_blank" rel="noopener">Amazon</a>
          </div>
        </div>
      </aside>
    </div>

    <p class="footer-note">Daily seed uses <b>America/Chicago</b> date so all visitors see the same puzzle for the day.</p>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script type="module">
    // ========= Helpers & Config =========
    const GRID_SIZE = 12;
    const WORDS_PER_PUZZLE = 12;
    const TIMEZONE = 'America/Chicago';

    // Pretty names for themes
    const THEME_DISPLAY_NAMES = {
      Animals: "Animals",
      Fruits: "Fruits",
      Vegetables: "Vegetables",
      Sports: "Sports",
      Colors: "Colors",
      Weather: "Weather",
      Transportation: "Transportation",
      Nature: "Nature",
      Music: "Music",
      School: "School",
      Ocean: "Ocean",
      Camping: "Camping",
      // Holidays
      NewYear: "New Year's Day",
      MLKDay: "Martin Luther King Jr. Day",
      PresidentsDay: "Presidents' Day",
      Valentine: "Valentine's Day",
      StPatricks: "St. Patrick's Day",
      Easter: "Easter",
      MothersDay: "Mother's Day",
      MemorialDay: "Memorial Day",
      Juneteenth: "Juneteenth",
      FathersDay: "Father's Day",
      IndependenceDay: "Independence Day",
      Patriotic: "Patriotic Week",
      LaborDay: "Labor Day",
      Halloween: "Halloween",
      Thanksgiving: "Thanksgiving",
      VeteransDay: "Veterans Day",
      Christmas: "Christmas"
    };

    // Minimal local fallback
    const WORD_LISTS = {
      Animals: [ "DOG","CAT","HORSE","LION","TIGER","BEAR","MONKEY","FISH","BIRD","FROG","WHALE","MOUSE" ],
      Colors: [ "RED","BLUE","GREEN","YELLOW","PURPLE","PINK","BLACK","WHITE","BROWN","ORANGE","GOLD","SILVER" ],
      Sports: [ "SOCCER","BASEBALL","FOOTBALL","GOLF","TENNIS","RUNNING","CYCLING","SKATING","ROWING","SURFING","SKIING","HIKING" ],
      Nature: [ "TREE","FLOWER","RIVER","MOUNTAIN","OCEAN","LAKE","FOREST","ISLAND","MEADOW","BEACH","VALLEY","CANYON" ]
    };

    // ========= API fetch (UPDATED to /worker/daily-words) =========
    async function getDailyWordsFromAPI() {
      try {
        const res = await fetch('/worker/daily-words', { cache: 'no-store' });
        if (!res.ok) return null;
        const data = await res.json();
        let words = Array.isArray(data?.words) ? data.words : null;
        if (!words) return null;
        words = [...new Set(words.map(w => String(w).toUpperCase().trim()))]
          .filter(w => /^[A-Z]{3,20}$/.test(w));
        return { theme: data.theme || 'Animals', words };
      } catch {
        return null;
      }
    }

    // ========= rest of your JS (unchanged) =========
    // ... all your existing logic for grid building, events, etc. ...
    // (no other changes required)
  </script>
</body>
</html>
